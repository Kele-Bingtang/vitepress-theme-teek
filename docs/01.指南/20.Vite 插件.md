---
title: Vite 插件
date: 2025-03-06 01:09:17
permalink: /guide/plugins
---

Vitepress 是基于 vite 进行搭建，因此可以编写 Vite 插件来辅助完成一些在无法在浏览器环境完成的动作，比如在 Vitepress 启动后，扫描文档目录下的 Markdown 文件，提取 `frontmatter` 的信息进行分析，或在渲染 Markdown 内容前，对其进行加工。

得益于 Vite 环境，Teeker 内置了一些 Vite 插件来执行在 Node 环境才能完成的事情，这些插件分别为：

- [vitepress-plugin-permalink](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-permalink/README.md)
- [vitepress-plugin-sidebar-resolve](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-sidebar-resolve/README.md)
- [vitepress-plugin-md-h1](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-md-h1/README.md)
- [vitepress-plugin-catalogue](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-catalogue/README.md)
- [vitepress-plugin-doc-analysis](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-doc-analysis/README.md)
- [vitepress-plugin-file-content-loader](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-file-content-loader/README.md)
- [vitepress-plugin-auto-frontmatter](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-auto-frontmatter/README.md)

这些插件已经上传至 NPM 仓库，具体的使用说明可以前往 NPM 查看使用说明，或者访问 [Github 仓库](https://github.com/Kele-Bingtang/vitepress-theme-teeker/tree/master/plugins)，每个插件下都有 `README.md` 文档介绍。

也可以在 Teeker 的 [配置项](/config/theme#vitePlugins) 中查看这些插件。

## vitepress-plugin-permalink

Teeker 使用 `vitepress-plugin-permalink` 来实现永久链接功能。

如果想要禁用该插件，进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    permalink: false,
  },
});
```

Teeker 默认扫描文档根目录下（srcDir）的所有 Markdown 文件，如果希望忽略某些目录，可进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    permalinkOption: {
      ignore: ["目录名"], // 支持正则表达式
    },
  },
});
```

当希望只扫描指定的目录，可进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    permalinkOption: {
      path: "guide", // 基于 package.json 所在目录，开头不需要有 /
    },
  },
});
```

`permalinkOption` 的 TS 类型如下：

```typescript
interface PermalinkOption {
  /**
   * 忽略的文件/文件夹列表，支持正则表达式
   *
   * @default []
   */
  ignoreList?: Array<RegExp | string>;
  /**
   * 文章所在的目录，基于 package.json 所在目录，开头不需要有 /
   * @default 'vitepress 的 srcDir 配置项'
   */
  path?: string;
}
```

### 国际化

`vitepress-plugin-permalink` 支持国际化功能，在生成 `permalink` 时，默认会给不同语言文档的 `permalink` 添加语言前缀，假如存在一个 Markdown 文档 `guide.md`，`frontmatter` 内容如下：

```yaml
---
title: guide
permalink: /guide
---
```

国际化目录结构如下；

```
docs/
├─ es/
│  ├─ guide.md
├─ guide.md
```

那么在生成 `permalink` 时，`es` 语言下的 `guide.md` 的 `permalink` 为 `/es/guide`。

## vitepress-plugin-sidebar-resolve

Teeker 使用 `vitepress-plugin-sidebar-resolve` 来实现自动生成侧边栏功能。

在 [结构化目录](/guide/directory-structure#特殊目录) 中已经介绍了该插件使用的注意事项，如果想要禁用该插件，进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    sidebar: false,
  },
});
```

### 国际化

在国际化的环境下，当把 root 语言（默认语言）的 Markdown 文件放到某个路径下时，`vitepress-plugin-sidebar-resolve` 无法感知到，因此请使用 `localeRootDir` 配置项告诉它，下面详细说明该场景。

Vitepress 支持的国际化文档目录如下：

```
docs/
├─ es/
│  ├─ foo.md
├─ fr/
│  ├─ foo.md
├─ foo.md
```

根目录下的 `foo.md` 是 root 语言（默认语言）的文档，当 Markdown 文件多起来时，根目录下文件显得很拥挤，那么可以将这些文档放到一个目录下，假设默认语言是 zh，则：

```
docs/
├─ es/
│  ├─ foo.md
├─ fr/
│  ├─ foo.md
├─ zh/
│  ├─ foo.md
```

但是 Vitepress 无法感知到 root 语言（默认语言）的文档已经放到 `zh` 目录下，它依然只扫描根目录的 Markdown 文件作为默认语言的文档，因此需要使用 Vitepress 提供的 `rewrites` 进行重定向，同时 `vitepress-plugin-sidebar-resolve` 插件无法感知文档进行了位移，因此需要配置 `localeRootDir`

```typescript
import { defineConfig } from "vitepress";
import tkThemeConfig from "vitepress-theme-teeker/config";

// Teeker 主题配置
const tkConfig = tkThemeConfig({
  vitePlugins: {
    sidebarOption: {
      localeRootDir: "zh",
    },
  },
});

// Vitepress 官方配置
export default defineConfig({
  rewrites: {
    "zh/:rest*": ":rest*",
  },
});
```

### 配置项

sidebarOption 的配置项如下：

```typescript
interface SidebarOption {
    /**
     * 生成侧边栏时，忽略的文件/文件夹列表，支持正则表达式
     *
     * @default []
     */
    ignoreList?: Array<RegExp | string>;
    /**
     * 文章所在的目录，基于 package.json 所在目录，开头不需要有 /
     *
     * @default 'vitepress 的 srcDir 配置项'
     */
    path?: string;
    /**
     * 是否忽略每个目录下的 index.md 文件
     *
     * @default false
     */
    ignoreIndexMd?: boolean;
    /**
     * 是否扫描根目录下的 md 文件作为 sideBar，如果为 true，则扫描根目录下的 md 文件作为 sideBar，且忽略根目录下的 index.md
     *
     * @default true
     */
    scannerRootMd?: boolean;
    /**
     * 是否默认折叠侧边栏
     *
     * @default true
     */
    collapsed?: boolean;
    /**
     * 文件名前缀必须以「数字.」开头
     *
     * @default true
     */
    fileIndexPrefix?: boolean;
    /**
     * 是否从 md 文件获取第一个一级标题作为侧边栏 text
     *
     * @default false
     * @remark 侧边栏 text 获取顺序
     * titleFormMd 为 true：md 文件 formatter.title > [md 文件第一个一级标题] > md 文件名
     * titleFormMd 为 false：md 文件 formatter.title > md 文件名
     */
    titleFormMd?: boolean;
    /**
     * 当 Vitepress 设置 locales 国际化后，如果将 root 语言（默认语言）的所有文件放到一个单独的目录下，如 zh，则需要将 localeRootDir 设为 zh，否则侧边栏无法知道文件都放到了 zh
     * 如果 root 语言（默认语言）的所有文件放在文档根目录下，则不需要设置 localeRootDir
     *
     * @default 文档根目录
     */
    localeRootDir?: string;
    /**
     * 解析完每个 sideBar 后的回调。每个 sideBar 指的是 SidebarOption.path 目录下的每个子目录
     *
     * @param data 当前 sideBar 列表
     * @default undefined
     */
    sideBarResolved?: (data: DefaultTheme.SidebarMulti) => DefaultTheme.SidebarMulti;
    /**
     * 解析完每个 sideBarItem 后的回调。每个 sideBarItem 指的是每个目录下的文件数组
     *
     * @param data 当前 sideBarItem 列表
     * @default undefined
     */
    sideBarItemsResolved?: (data: DefaultTheme.SidebarItem[]) => DefaultTheme.SidebarItem[];
    /**
     * 创建 sideBarItem 之前的回调。每个 sideBarItem 指的是每个目录下的文件数组
     *
     *
     * @param data 将要解析的所有文件名
     * @default undefined
     * @remark 可以过滤掉不需要解析为 sideBarItem 的文件
     */
    beforeCreateSideBarItems?: (data: string[]) => string[];
}
```

## vitepress-plugin-md-h1

Teeker 使用 `vitepress-plugin-md-h1` 来给文章页生成一级标题（假如 markdown 文档没有设置过一级标题）。

一级标题获取顺序：`frontmatter.title` > 文件名

::: tip
只在页面加载 markdown 内容时生成一级标题，并不会真正修改 markdown 文档内容。
:::

假设一个文档 `install.md` 的 `frontmatter` 内容如下：

```yaml
---
title: guide
---
```

在页面访问该文档时，页面自动生成一级标题 `guide`，当把 `frontmatter.title` 去掉后，页面的一级标题变为 `install`。

如果想要禁用该插件，进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    mdH1: false,
  },
});
```

## vitepress-plugin-catalogue

`vitepress-plugin-sidebar-resolve` 插件会将所有 `formatter.catalogue` 为 true 的文档信息挂载到 `themeConfig.catalogues` 中，Teeker 使用该数据来生成目录页。

该插件与 Teeker 强绑定，无法像上面的组件一样，通过 `vitePlugins.catalogue = false` 来禁用。

如果想要禁用该插件，只能通过禁用 Teeker 主题来实现，配置如下：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  tkTheme: false, // 禁用 Teeker 主题
});
```

### 配置项

```typescript
interface CatalogueOption {
    /**
     * 忽略的文件/文件夹列表，支持正则表达式
     *
     * @default []
     */
    ignoreList?: Array<RegExp | string>;
    /**
     * 文章所在的目录，基于 package.json 所在目录
     *
     * @default 'vitepress 的 srcDir 配置项'
     */
    path?: string;
    /**
     * 是否忽略每个目录下的 index.md 文件
     *
     * @default false
     */
    ignoreIndexMd?: boolean;
    /**
     * 控制是否从 md 文件获取第一个一级标题作为侧边栏 text
     *
     * @default false
     * @remark 侧边栏 text 获取顺序
     * titleFormMd 为 true：md 文件 formatter.title > [md 文件第一个一级标题] > md 文件名
     * titleFormMd 为 false：md 文件 formatter.title > md 文件名
     */
    titleFormMd?: boolean;
}
```

## vitepress-plugin-doc-analysis

Teeker 使用 `vitepress-plugin-doc-analysis` 来实现站点信息和文章页信息功能。

`vitepress-plugin-doc-analysis` 在 Vitepress 启动后，扫描所有的 Markdown 文档，然后统计文章数量，文章字数等，最终将分析后的数据挂载到 `themeConfig.docAnalysisInfo` 中。

在首页看到的站点信息、文章页看到的文章字数、预计阅读时间等，都是使用 `themeConfig.docAnalysisInfo` 的数据来构成。

如果不希望某个 markdown 文档被插件分析，请在该文档 `frontmatter` 配置：

```yaml
---
docAnalysis: false
---
```

如果想要禁用该插件，进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    docAnalysis: false,
  },
});
```

关于文章的预计阅读时间的计算，该插件默认 1 分钟内阅读的中文字数为 300，1 分钟内阅读的英文字数为 160，如果认为不合理，可以对其进行修改：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    docAnalysisOption: {
      cn: 400,
      en: 200,
    },
  },
});
```

### 国际化

当处于国际化环境下，插件将不同语言的数据挂载到 `locales.[lang].themeConfig.docAnalysisInfo`。

### 配置项

```typescript
interface DocAnalysisOption {
    /**
     * 忽略的文件/文件夹列表，支持正则表达式
     *
     * @default []
     */
    ignoreList?: Array<RegExp | string>;
    /**
     * 文章所在的目录，基于 package.json 所在目录，开头不需要有 /
     *
     * @default 'vitepress 的 srcDir 配置项'
     */
    path?: string;
    /**
     * 是否忽略每个目录下的 index.md 文件
     *
     * @default false
     */
    ignoreIndexMd?: boolean;
    /**
     * 1 分钟内阅读的中文字数
     * @default 300
     */
    cn?: number;
    /**
     * 1 分钟内阅读的英文字数
     * @default 160
     */
    en?: number;
}
```

## vitepress-plugin-file-content-loader

Teeker 使用 `vitepress-plugin-file-content-loader` 来构建首页的文章列表和归档页数据，并挂载到 `themeConfig.posts` 中。

该插件本质上将 Vitepress 官网的 [构建时数据加载](https://vitepress.dev/zh/guide/data-loading) 功能转为插件，因此具体的介绍说明请前往 Vitepress 官网阅读。

::: info 为什么设计为插件？
构建时数据加载功能是在访问网站的时候开始执行，如果使用该功能扫描了大量的 Markdown 文档，那么会导致第一次进入页面卡顿，因此基于该功能实现了插件，在项目启动过程完成数据的加载。
:::

该插件与 Teeker 强绑定，如果想要禁用该插件，只能通过禁用 Teeker 主题来实现，配置如下：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  tkTheme: false, // 禁用 Teeker 主题
});
```

### 国际化

当处于国际化环境下，插件将不同语言的数据挂载到 `posts.locales.[lang]` 下。

## vitepress-plugin-auto-frontmatter

Teeker 使用 `vitepress-plugin-auto-frontmatter` 自动给 Markdown 文档添加 `frontmatter`。

该插件会直接修改 Markdown 文档的 `frontmatter`，因此为了安全性考虑，默认是关闭的，如果希望开启，进行如下配置：

```typescript
import tkThemeConfig from "vitepress-theme-teeker/config";

const tkConfig = tkThemeConfig({
  vitePlugins: {
    autoFrontmatter: true,
  },
});
```

如果开启了该插件，那么 Teeker 将会对所有 Markdown 文档的 `frontmatter` 添加如下格式：

```yaml
---
date: 2025-03-03 00:45:16
title: getting
permalink: /pages/eb8f2f
categories:
  - guide
---
```

- `date` 为文章的创建时间
- `title` 为文章的标题
- `permalink` 为文章的永久链接，采用随机数确保唯一
- `categories` 为文章的分类，根据目录层级获取

::: tip

Teeker 则不会修改已经存在的数据，判断的规则是比较 key，不比较 value。

:::

如果需要拓展自定义 `frontmatter`，让 Teeker 在生成 `frontmatter` 的时候额外添加其他数据，请使用 `transform` 配置项，具体使用请看 [vitepress-plugin-auto-frontmatter](https://github.com/Kele-Bingtang/vitepress-theme-teeker/blob/master/plugins/vitepress-plugin-auto-frontmatter/README.md) 的 `Example 2` 和 `Example 3`。


### 配置项

```typescript
import type { GlobOptions } from "tinyglobby";

export interface AutoFrontmatterOption {
  /**
   * 扫描的文件路径表达式，为 global 表达式
   */
  pattern?: string | string[];
  /**
   * include 指定的对象如果不在 markdown frontmatter 存在，则忽略该文件
   */
  include?: Record<string, any>;
  /**
   * exclude 指定的对象如果在 markdown frontmatter 存在，则忽略该文件。当 include 和 exclude 存在相同文件时，exclude 优先级高
   */
  exclude?: Record<string, any>;
  /**
   * 转换处理好的 frontmatter，该函数需要返回一个新的 frontmatter 或只返回 undefined，如果返回 {}，则清空 MD 文件本身存在的 frontmatter
   */
  transform?: (frontmatter: Record<string, any>, fileInfo: FileInfo) => Record<string, any> | void;
  /**
   * tinyglobby 的配置项
   * 插件默认已经忽略 node_modules 和 dist 目录的所有文件
   */
  globOptions?: GlobOptions;
}

export interface FileInfo {
  /**
   * 文件绝对路径
   */
  filePath: string;
  /**
   * 文件相对路径
   */
  relativePath: string;
}
```